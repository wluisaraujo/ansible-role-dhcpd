---
### tasks file for iac-ansible-dhcp-server
- name: Define o arquivos de configuracao
  copy: 
    src: fixedaddress.conf 
    dest: /etc/dhcp/fixedaddress.conf 
    owner: root 
    group: root 
    mode: 0644
  when: ( dhcp_installed is success )
  register: FIXEDCONF
  
- template:
    src: dhcpd-vlan.j2
    dest: /etc/dhcp/dhcpd-vlan1.conf
    owner: root
    group: root
    mode: 0644
  register: VLAN1
  when: ( FIXEDCONF is success )
  vars:
    subnet: 192.168.200.0
    netmask: 255.255.255.128
    nic: eth1
    range_start: 192.168.200.100
    range_end: 192.168.200.110
    router1: 192.168.200.1
    router2: 192.168.200.129
    broadcast: 192.168.200.127
    
- template:
    src: dhcpd-vlan.j2
    dest: /etc/dhcp/dhcpd-vlan2.conf
    owner: root
    group: root
    mode: 0644
  register: VLAN2
  when: ( VLAN1 is success )
  vars:
    subnet: 192.168.200.128
    netmask: 255.255.255.255
    nic: eth2
    range_start: 192.168.200.200
    range_end: 192.168.200.210
    router1: 192.168.200.129
    router2: 192.168.200.1
    broadcast: 192.168.200.255

- template:
    src: dhcpd.j2
    dest: /etc/dhcp/dhcpd.conf
    force: yes
    owner: root
    group: root
    mode: 0644
  when: 
    - FIXEDCONF is success
    - VLAN1 is success
    - VLAN2 is success
  notify:
    - Restart dhcp-server




#- name: Define o arquivo de configuracao dhcpd-vlan1.conf
#  when: fixedconf|success
#  copy: src=dhcpd-vlan1.conf dest=/etc/dhcp/dhcpd-vlan1.conf owner=root group=root mode=0644
#  register: vlan1conf

#- name: Define o arquivo de configuracao dhcpd-vlan2.conf
#  when: vlan1conf|success
#  copy: src=dhcpd-vlan2.conf dest=/etc/dhcp/dhcpd-vlan2.conf owner=root group=root mode=0644
#  register: vlan2conf

#- name: Define o arquivo de configuracao /etc/dhcp/dhcpd.conf
#  when: vlan2conf|success
#  copy: src=dhcpd.conf dest=/etc/dhcp/dhcpd.conf owner=root group=root mode=0644
#  notify:
#    - Restart dhcp-server

### tasks file for iac-ansible-dhcp-server
#- name: Define o arquivo de configuracao fixedaddress.conf
#  copy: 
#    src: fixedaddress.conf 
#    dest: /etc/dhcp/fixedaddress.conf 
#    owner: root 
#    group: root 
#    mode: 0644
#  when: dhcp_installed|success
#  register: fixedconf

#- name: Define o arquivo de configuracao dhcpd-vlan1.conf
#  template:
#    src: dhcpdvlan.j2
#    dest: /etc/dhcp/dhcpd-vlan1.conf
#    owner: root
#    group: root
#    mode: 0644
#    backup: yes
#  register: vlan1conf
#  when: fixedconf|success
#  
#- name: Define o arquivo de configuracao dhcpd-vlan2.conf
#  copy: 
#    src: dhcpd-vlan.conf 
#    dest: /etc/dhcp/dhcpd-vlan2.conf 
#    owner: root 
#    group: root 
#    mode: 0644
#  register: vlan2conf
#  when: vlan1conf|success
#

...
